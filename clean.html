<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ëŒ€ì²­ì†Œ êµ¬ì—­ ëœë¤ ë°°ì •ê¸°</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif; }
    body { margin: 0; background: #f6f7fb; color: #111; }
    .wrap { max-width: 1100px; margin: 24px auto; padding: 0 16px 40px; }
    .title { display:flex; justify-content:space-between; align-items:flex-end; gap:12px; flex-wrap:wrap; }
    h1 { margin: 0; font-size: 22px; }
    .sub { margin: 6px 0 0; color:#555; font-size: 13px; }
    .grid { display:grid; grid-template-columns: 1fr; gap: 14px; margin-top: 16px; }
    @media (min-width: 960px) { .grid { grid-template-columns: 1fr 1fr; } }
    .card { background:#fff; border-radius: 14px; padding: 14px; box-shadow: 0 6px 20px rgba(0,0,0,.06); }
    .card h2 { margin: 0 0 10px; font-size: 16px; }
    .row { display:flex; gap: 10px; align-items:center; flex-wrap:wrap; }
    label { font-size: 13px; color:#333; display:flex; gap:8px; align-items:center; }
    input, select, textarea, button {
      font: inherit;
      padding: 9px 10px;
      border-radius: 10px;
      border: 1px solid #d7dbe7;
      background:#fff;
      outline: none;
    }
    input:focus, select:focus, textarea:focus { border-color:#7b8cff; box-shadow: 0 0 0 3px rgba(123,140,255,.18); }
    input[type="number"] { width: 110px; }
    .btns { display:flex; gap: 8px; flex-wrap:wrap; margin-top: 10px; }
    button { cursor:pointer; border: 1px solid #cfd5ea; background:#f3f5ff; }
    button.primary { background:#3b5bff; border-color:#3b5bff; color:#fff; }
    button.danger { background:#fff3f3; border-color:#ffd2d2; }
    .small { font-size: 12px; color:#666; }
    .pill { display:inline-flex; gap:8px; align-items:center; background:#eef2ff; color:#2a3cff; padding: 4px 10px; border-radius: 999px; font-size:12px; }
    table { width: 100%; border-collapse: separate; border-spacing: 0; overflow:hidden; border-radius: 12px; border:1px solid #e3e7f3; }
    th, td { padding: 10px; border-bottom: 1px solid #e3e7f3; vertical-align: top; }
    th { background:#f7f8ff; text-align:left; font-size: 13px; color:#333; }
    tr:last-child td { border-bottom: none; }
    .muted { color:#777; }
    .right { margin-left:auto; }
    .req-list td:last-child { width: 120px; }
    .tag { display:inline-block; font-size:12px; color:#444; background:#f1f3f7; padding: 2px 8px; border-radius: 999px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .warn { color:#b45309; }
    .ok { color:#0f766e; }
    .error { color:#b91c1c; }
    textarea { width: 100%; min-height: 140px; resize: vertical; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">
      <div>
        <h1>ëŒ€ì²­ì†Œ êµ¬ì—­ ëœë¤ ë°°ì •ê¸°</h1>
        <div class="sub">ì´ ì¸ì›ê³¼ ì²­ì†Œêµ¬ì—­ë³„ í•„ìš” ì¸ì›ë§Œ ì…ë ¥í•˜ë©´, ì¶œì„ë²ˆí˜¸(1~N)ë¥¼ ëœë¤ìœ¼ë¡œ ìë™ ë°°ì •í•©ë‹ˆë‹¤.</div>
      </div>
      <div class="pill" id="statusPill">ì¤€ë¹„ë¨</div>
    </div>

    <div class="grid">
      <!-- ì„¤ì • -->
      <div class="card">
        <h2>1) ê¸°ë³¸ ì„¤ì •</h2>
        <div class="row">
          <label>ì´ ì¸ì›ìˆ˜
            <input type="number" id="totalStudents" min="1" value="25" />
          </label>
          <label>ì¶œì„ ì‹œì‘ë²ˆí˜¸
            <input type="number" id="startNo" min="0" value="1" />
          </label>
          <label>ë‚¨ëŠ” ì¸ì› ì²˜ë¦¬
            <select id="leftoverMode">
              <option value="unassigned">ë¯¸ë°°ì •(ê³µìš©) êµ¬ì—­ì— ëª¨ìœ¼ê¸°</option>
              <option value="roundrobin">ê¸°ì¡´ êµ¬ì—­ì— 1ëª…ì”© ëŒë ¤ë°°ì •</option>
            </select>
          </label>
        </div>
        <div class="small" style="margin-top:8px;">
          â€» í•„ìš” ì¸ì› í•©ì´ ì´ ì¸ì›ë³´ë‹¤ <b>í¬ë©´</b> ë°°ì •ì´ ë¶ˆê°€í•©ë‹ˆë‹¤. í•©ì´ <b>ì‘ìœ¼ë©´</b> ë‚¨ëŠ” ì¸ì›ì„ ì²˜ë¦¬ ë°©ì‹ì— ë”°ë¼ ë°°ì •í•©ë‹ˆë‹¤.
        </div>
      </div>

      <!-- êµ¬ì—­ ëª©ë¡ ê´€ë¦¬ -->
      <div class="card">
        <h2>2) ì²­ì†Œêµ¬ì—­ ëª©ë¡(ë“œë¡­ë‹¤ìš´)</h2>
        <div class="row">
          <label>êµ¬ì—­ ì¶”ê°€
            <input type="text" id="newAreaName" placeholder="ì˜ˆ) ì°½ë¬¸, ë³µë„, ì¹ íŒ, ë¶„ë¦¬ìˆ˜ê±°..." />
          </label>
          <button id="addAreaBtn">ëª©ë¡ì— ì¶”ê°€</button>
          <button class="danger" id="resetAreasBtn">ì´ˆê¸° ì˜ˆì‹œë¡œ ë˜ëŒë¦¬ê¸°</button>
        </div>

        <div class="small" style="margin-top:10px;">í˜„ì¬ ëª©ë¡</div>
        <div id="areaChips" style="margin-top:8px; display:flex; gap:6px; flex-wrap:wrap;"></div>

        <div class="small warn" style="margin-top:10px;">
          â€» ì•„ë˜ â€œêµ¬ì—­ë³„ í•„ìš” ì¸ì›â€ì—ì„œëŠ” ì´ ëª©ë¡ì´ <b>ë“œë¡­ë‹¤ìš´</b>ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
        </div>
      </div>

      <!-- êµ¬ì—­ë³„ í•„ìš” ì¸ì› -->
      <div class="card" style="grid-column: 1 / -1;">
        <h2>3) êµ¬ì—­ë³„ í•„ìš” ì¸ì›</h2>
        <div class="row">
          <label>êµ¬ì—­ ì„ íƒ
            <select id="areaSelect"></select>
          </label>
          <label>í•„ìš” ì¸ì›
            <input type="number" id="areaNeed" min="1" value="4" />
          </label>
          <button id="addReqBtn">ì¶”ê°€</button>
          <div class="right small">
            í•„ìš” ì¸ì› í•©: <b id="sumNeed">0</b> / ì´ ì¸ì›: <b id="sumTotal">0</b>
            <span class="tag" id="sumHint"></span>
          </div>
        </div>

        <div style="margin-top:12px; overflow:auto;">
          <table class="req-list">
            <thead>
              <tr>
                <th>ì²­ì†Œêµ¬ì—­</th>
                <th>í•„ìš” ì¸ì›</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="reqTbody">
              <!-- rows -->
            </tbody>
          </table>
        </div>

        <div class="btns">
          <button class="primary" id="assignBtn">ğŸ² ëœë¤ ë°°ì •í•˜ê¸°</button>
          <button id="reshuffleBtn" disabled>ğŸ” ë‹¤ì‹œ ì„ê¸°(ê°™ì€ ì¡°ê±´)</button>
          <button id="copyBtn" disabled>ğŸ“‹ ê²°ê³¼ ë³µì‚¬</button>
          <button id="csvBtn" disabled>â¬‡ï¸ CSV ë‹¤ìš´ë¡œë“œ</button>
          <button class="danger" id="clearReqBtn">ìš”êµ¬ ëª©ë¡ ë¹„ìš°ê¸°</button>
        </div>
      </div>

      <!-- ê²°ê³¼ -->
      <div class="card" style="grid-column: 1 / -1;">
        <h2>4) ë°°ì • ê²°ê³¼</h2>
        <div class="small muted">êµ¬ì—­ë³„ ë°°ì •ëœ ì¶œì„ë²ˆí˜¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
        <div style="margin-top:12px; overflow:auto;">
          <table>
            <thead>
              <tr>
                <th>ì²­ì†Œêµ¬ì—­</th>
                <th>ë°°ì • ì¸ì›</th>
                <th>ì¶œì„ë²ˆí˜¸</th>
              </tr>
            </thead>
            <tbody id="resultTbody">
              <tr><td colspan="3" class="muted">ì•„ì§ ë°°ì •í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</td></tr>
            </tbody>
          </table>
        </div>

        <div class="small" style="margin-top:10px;">
          í…ìŠ¤íŠ¸ ê²°ê³¼(ë³µì‚¬ìš©):
        </div>
        <textarea id="resultText" class="mono" readonly placeholder="ì—¬ê¸°ì— ê²°ê³¼ê°€ ìƒì„±ë©ë‹ˆë‹¤."></textarea>
      </div>
    </div>
  </div>

<script>
  // ---------- Utils ----------
  function $(id){ return document.getElementById(id); }
  function setStatus(text, kind="ok"){
    const pill = $("statusPill");
    pill.textContent = text;
    pill.style.background = kind==="error" ? "#fff1f2" : kind==="warn" ? "#fff7ed" : "#ecfeff";
    pill.style.color = kind==="error" ? "#b91c1c" : kind==="warn" ? "#b45309" : "#0f766e";
  }
  function shuffle(arr){
    // Fisher-Yates
    for(let i = arr.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }
  function downloadText(filename, text){
    const blob = new Blob([text], {type:"text/plain;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  // ---------- State ----------
  const defaultAreas = ["ì°½ë¬¸", "ë°”ë‹¥", "ì±…ìƒì •ë¦¬", "ì¹ íŒ/êµíƒ", "ë³µë„", "ë¶„ë¦¬ìˆ˜ê±°", "ì‚¬ë¬¼í•¨", "ì²­ì†Œë„êµ¬ì •ë¦¬"];
  let areas = [...defaultAreas];
  let requirements = []; // {area, need}
  let lastAssignment = null; // {reqsUsed, total, startNo, leftoverMode}

  // ---------- UI Rendering ----------
  function renderAreaChips(){
    const box = $("areaChips");
    box.innerHTML = "";
    areas.forEach((name, idx) => {
      const chip = document.createElement("span");
      chip.className = "pill";
      chip.style.background = "#f1f5f9";
      chip.style.color = "#334155";
      chip.innerHTML = `<span>${name}</span>
        <button title="ì‚­ì œ" style="margin-left:6px; padding:2px 8px; border-radius:999px; border:1px solid #d7dbe7; background:#fff; cursor:pointer;">Ã—</button>`;
      chip.querySelector("button").addEventListener("click", () => {
        // ëª©ë¡ì—ì„œ ì‚­ì œ (ë‹¨, ìš”êµ¬ ëª©ë¡ì—ì„œ ì‚¬ìš© ì¤‘ì´ë©´ ì‚­ì œ ë°©ì§€)
        const used = requirements.some(r => r.area === name);
        if(used){
          alert("ì´ êµ¬ì—­ì€ 'êµ¬ì—­ë³„ í•„ìš” ì¸ì›'ì—ì„œ ì‚¬ìš© ì¤‘ì´ë¼ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\në¨¼ì € ìš”êµ¬ ëª©ë¡ì—ì„œ ì œê±°í•´ì£¼ì„¸ìš”.");
          return;
        }
        areas.splice(idx, 1);
        renderAreaChips();
        renderAreaSelect();
      });
      box.appendChild(chip);
    });
    if(areas.length === 0){
      box.innerHTML = `<span class="muted">êµ¬ì—­ ëª©ë¡ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. êµ¬ì—­ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.</span>`;
    }
  }

  function renderAreaSelect(){
    const sel = $("areaSelect");
    sel.innerHTML = "";
    areas.forEach(a => {
      const opt = document.createElement("option");
      opt.value = a; opt.textContent = a;
      sel.appendChild(opt);
    });
    if(areas.length === 0){
      const opt = document.createElement("option");
      opt.value = ""; opt.textContent = "êµ¬ì—­ ëª©ë¡ì´ ë¹„ì–´ìˆìŒ";
      sel.appendChild(opt);
    }
  }

  function renderRequirements(){
    const tb = $("reqTbody");
    tb.innerHTML = "";
    requirements.forEach((r, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${r.area}</td>
        <td>
          <input type="number" min="1" value="${r.need}" data-idx="${i}" style="width:90px;" />
        </td>
        <td style="text-align:right;">
          <button class="danger" data-del="${i}">ì‚­ì œ</button>
        </td>
      `;
      tb.appendChild(tr);
    });
    if(requirements.length === 0){
      const tr = document.createElement("tr");
      tr.innerHTML = `<td colspan="3" class="muted">ì•„ì§ ì¶”ê°€ëœ êµ¬ì—­ì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ êµ¬ì—­ì„ ì„ íƒí•˜ê³  í•„ìš” ì¸ì›ì„ ì¶”ê°€í•˜ì„¸ìš”.</td>`;
      tb.appendChild(tr);
    }

    // bind need change
    tb.querySelectorAll('input[type="number"][data-idx]').forEach(inp => {
      inp.addEventListener("change", (e) => {
        const idx = Number(e.target.dataset.idx);
        const v = Number(e.target.value);
        requirements[idx].need = Math.max(1, Math.floor(v || 1));
        updateSumHint();
      });
    });

    // bind delete
    tb.querySelectorAll("button[data-del]").forEach(btn => {
      btn.addEventListener("click", (e) => {
        const idx = Number(e.target.dataset.del);
        requirements.splice(idx, 1);
        updateSumHint();
        renderRequirements();
        disableResultButtons();
      });
    });

    updateSumHint();
  }

  function updateSumHint(){
    const total = Number($("totalStudents").value || 0);
    const sumNeed = requirements.reduce((s,r) => s + Number(r.need||0), 0);
    $("sumNeed").textContent = sumNeed;
    $("sumTotal").textContent = total;

    const hint = $("sumHint");
    hint.textContent = "";

    if(total <= 0){
      hint.textContent = "ì´ ì¸ì› ì…ë ¥ í•„ìš”";
      hint.className = "tag error";
      setStatus("ì´ ì¸ì›ì„ ì…ë ¥í•˜ì„¸ìš”", "warn");
      return;
    }

    if(sumNeed === 0){
      hint.textContent = "êµ¬ì—­/ì¸ì› ì¶”ê°€ í•„ìš”";
      hint.className = "tag warn";
      setStatus("êµ¬ì—­ë³„ í•„ìš” ì¸ì›ì„ ì¶”ê°€í•˜ì„¸ìš”", "warn");
      return;
    }

    if(sumNeed > total){
      hint.textContent = "í•„ìš” ì¸ì› í•©ì´ ë” í¼";
      hint.className = "tag error";
      setStatus("í•„ìš” ì¸ì› í•©ì´ ì´ ì¸ì›ë³´ë‹¤ í½ë‹ˆë‹¤", "error");
    } else if(sumNeed < total){
      hint.textContent = "ë‚¨ëŠ” ì¸ì› ìˆìŒ";
      hint.className = "tag warn";
      setStatus("ë‚¨ëŠ” ì¸ì›ì´ ìˆìŠµë‹ˆë‹¤(ì²˜ë¦¬ ë°©ì‹ ì ìš©)", "warn");
    } else {
      hint.textContent = "ì •í™•íˆ ì¼ì¹˜";
      hint.className = "tag ok";
      setStatus("ë°°ì • ì¤€ë¹„ ì™„ë£Œ", "ok");
    }
  }

  function disableResultButtons(){
    $("reshuffleBtn").disabled = true;
    $("copyBtn").disabled = true;
    $("csvBtn").disabled = true;
    lastAssignment = null;
  }

  // ---------- Core Assignment ----------
  function makeAssignment(){
    const total = Math.floor(Number($("totalStudents").value));
    const startNo = Math.floor(Number($("startNo").value));
    const leftoverMode = $("leftoverMode").value;

    if(!Number.isFinite(total) || total <= 0){
      alert("ì´ ì¸ì›ìˆ˜ëŠ” 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
      return null;
    }
    if(!Number.isFinite(startNo)){
      alert("ì¶œì„ ì‹œì‘ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
      return null;
    }
    if(requirements.length === 0){
      alert("êµ¬ì—­ë³„ í•„ìš” ì¸ì›ì„ í•˜ë‚˜ ì´ìƒ ì¶”ê°€í•´ì£¼ì„¸ìš”.");
      return null;
    }

    const sumNeed = requirements.reduce((s,r)=> s + Math.floor(Number(r.need||0)), 0);
    if(sumNeed > total){
      alert(`í•„ìš” ì¸ì› í•©(${sumNeed})ì´ ì´ ì¸ì›(${total})ë³´ë‹¤ í½ë‹ˆë‹¤.\ní•„ìš” ì¸ì›ì„ ì¤„ì´ê±°ë‚˜ ì´ ì¸ì›ì„ ëŠ˜ë ¤ì£¼ì„¸ìš”.`);
      return null;
    }

    // ì¶œì„ë²ˆí˜¸ ìƒì„±
    const nums = [];
    for(let i=0; i<total; i++){
      nums.push(startNo + i);
    }
    shuffle(nums);

    // ê¸°ë³¸ ë°°ì •
    const result = [];
    let cursor = 0;

    requirements.forEach(r => {
      const need = Math.floor(Number(r.need||0));
      const assigned = nums.slice(cursor, cursor + need);
      cursor += need;
      result.push({ area: r.area, assigned });
    });

    // ë‚¨ëŠ” ì¸ì› ì²˜ë¦¬
    const leftover = nums.slice(cursor);
    if(leftover.length > 0){
      if(leftoverMode === "unassigned"){
        result.push({ area: "ê³µìš©/ë¯¸ë°°ì •", assigned: leftover });
      } else {
        // round-robin
        let k = 0;
        while(k < leftover.length){
          for(let i=0; i<result.length && k < leftover.length; i++){
            result[i].assigned.push(leftover[k++]);
          }
        }
      }
    }

    // ê²°ê³¼ í…ìŠ¤íŠ¸
    const lines = [];
    lines.push(`ëŒ€ì²­ì†Œ ëœë¤ ë°°ì • ê²°ê³¼`);
    lines.push(`- ì´ ì¸ì›: ${total}ëª… (ì¶œì„ ì‹œì‘ë²ˆí˜¸: ${startNo})`);
    lines.push(`- í•„ìš” ì¸ì› í•©: ${sumNeed}ëª…`);
    if(leftover.length > 0){
      lines.push(`- ë‚¨ëŠ” ì¸ì›: ${leftover.length}ëª… (${leftoverMode === "unassigned" ? "ê³µìš©/ë¯¸ë°°ì •ìœ¼ë¡œ ëª¨ìŒ" : "ëŒë ¤ë°°ì •"})`);
    }
    lines.push("");
    result.forEach(r => {
      const list = r.assigned.join(", ");
      lines.push(`[${r.area}] (${r.assigned.length}ëª…) : ${list}`);
    });

    return {
      meta: { total, startNo, sumNeed, leftoverCount: leftover.length, leftoverMode },
      result,
      text: lines.join("\n")
    };
  }

  function renderResult(assignment){
    const tb = $("resultTbody");
    tb.innerHTML = "";
    assignment.result.forEach(r => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><b>${r.area}</b></td>
        <td>${r.assigned.length}</td>
        <td class="mono">${r.assigned.join(", ")}</td>
      `;
      tb.appendChild(tr);
    });
    $("resultText").value = assignment.text;

    $("reshuffleBtn").disabled = false;
    $("copyBtn").disabled = false;
    $("csvBtn").disabled = false;

    lastAssignment = {
      reqsUsed: JSON.parse(JSON.stringify(requirements)),
      total: assignment.meta.total,
      startNo: assignment.meta.startNo,
      leftoverMode: assignment.meta.leftoverMode
    };

    setStatus("ë°°ì • ì™„ë£Œ", "ok");
  }

  // ---------- Events ----------
  $("addAreaBtn").addEventListener("click", () => {
    const name = $("newAreaName").value.trim();
    if(!name) return;
    if(areas.includes(name)){
      alert("ì´ë¯¸ ëª©ë¡ì— ìˆëŠ” êµ¬ì—­ì…ë‹ˆë‹¤.");
      return;
    }
    areas.push(name);
    $("newAreaName").value = "";
    renderAreaChips();
    renderAreaSelect();
  });

  $("resetAreasBtn").addEventListener("click", () => {
    // ì‚¬ìš© ì¤‘ì¸ êµ¬ì—­ì´ ìˆìœ¼ë©´ ì´ˆê¸°í™” ë°©ì§€
    const usedNames = new Set(requirements.map(r => r.area));
    if(usedNames.size > 0){
      alert("ìš”êµ¬ ëª©ë¡(êµ¬ì—­ë³„ í•„ìš” ì¸ì›)ì— ì‚¬ìš© ì¤‘ì¸ êµ¬ì—­ì´ ìˆì–´ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\në¨¼ì € ìš”êµ¬ ëª©ë¡ì„ ë¹„ìš´ ë’¤ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
      return;
    }
    areas = [...defaultAreas];
    renderAreaChips();
    renderAreaSelect();
  });

  $("addReqBtn").addEventListener("click", () => {
    if(areas.length === 0){
      alert("ë¨¼ì € ì²­ì†Œêµ¬ì—­ ëª©ë¡ì— êµ¬ì—­ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.");
      return;
    }
    const area = $("areaSelect").value;
    const need = Math.max(1, Math.floor(Number($("areaNeed").value || 1)));

    if(!area){
      alert("êµ¬ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }
    // ë™ì¼ êµ¬ì—­ì€ 1ê°œë§Œ ìœ ì§€(ìˆ˜ì •ì€ í…Œì´ë¸”ì—ì„œ)
    const exists = requirements.find(r => r.area === area);
    if(exists){
      exists.need = need;
    } else {
      requirements.push({ area, need });
    }
    renderRequirements();
    disableResultButtons();
  });

  $("clearReqBtn").addEventListener("click", () => {
    requirements = [];
    renderRequirements();
    $("resultTbody").innerHTML = `<tr><td colspan="3" class="muted">ì•„ì§ ë°°ì •í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</td></tr>`;
    $("resultText").value = "";
    disableResultButtons();
    setStatus("ìš”êµ¬ ëª©ë¡ì„ ë¹„ì› ìŠµë‹ˆë‹¤", "warn");
  });

  $("totalStudents").addEventListener("change", () => { updateSumHint(); disableResultButtons(); });
  $("startNo").addEventListener("change", () => { disableResultButtons(); });
  $("leftoverMode").addEventListener("change", () => { disableResultButtons(); });

  $("assignBtn").addEventListener("click", () => {
    const assignment = makeAssignment();
    if(!assignment) return;
    renderResult(assignment);
  });

  $("reshuffleBtn").addEventListener("click", () => {
    if(!lastAssignment){
      alert("ë¨¼ì € ë°°ì •ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.");
      return;
    }
    // í˜„ì¬ ìš”êµ¬ ëª©ë¡ì´ ë°”ë€Œì—ˆëŠ”ì§€ ì²´í¬(ë°”ë€Œì—ˆìœ¼ë©´ ì•ˆë‚´)
    const nowSig = JSON.stringify(requirements);
    const lastSig = JSON.stringify(lastAssignment.reqsUsed);
    if(nowSig !== lastSig){
      const ok = confirm("ìš”êµ¬ ëª©ë¡ì´ ì´ì „ ë°°ì •ê³¼ ë‹¬ë¼ì¡ŒìŠµë‹ˆë‹¤.\ní˜„ì¬ ì¡°ê±´ìœ¼ë¡œ ë‹¤ì‹œ ì„ì–´ ë°°ì •í• ê¹Œìš”?");
      if(!ok) return;
    }
    const assignment = makeAssignment();
    if(!assignment) return;
    renderResult(assignment);
  });

  $("copyBtn").addEventListener("click", async () => {
    try{
      await navigator.clipboard.writeText($("resultText").value);
      setStatus("í´ë¦½ë³´ë“œì— ë³µì‚¬ë¨", "ok");
    } catch(e){
      alert("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í…ìŠ¤íŠ¸ ë°•ìŠ¤ì—ì„œ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.");
    }
  });

  $("csvBtn").addEventListener("click", () => {
    const txt = $("resultText").value.trim();
    if(!txt){
      alert("ë‹¤ìš´ë¡œë“œí•  ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
      return;
    }
    // CSV: area, count, numbers
    const rows = [["êµ¬ì—­","ì¸ì›","ì¶œì„ë²ˆí˜¸"]];
    const tb = $("resultTbody");
    const trs = tb.querySelectorAll("tr");
    trs.forEach(tr => {
      const tds = tr.querySelectorAll("td");
      if(tds.length === 3){
        rows.push([tds[0].innerText.trim(), tds[1].innerText.trim(), tds[2].innerText.trim()]);
      }
    });
    const csv = rows.map(r => r.map(v => `"${String(v).replaceAll('"','""')}"`).join(",")).join("\n");
    downloadText("cleaning_assignment.csv", csv);
    setStatus("CSV ë‹¤ìš´ë¡œë“œ ì™„ë£Œ", "ok");
  });

  // ---------- Init ----------
  function init(){
    renderAreaChips();
    renderAreaSelect();
    renderRequirements();
    $("sumTotal").textContent = Number($("totalStudents").value || 0);
    updateSumHint();
  }
  init();
</script>
</body>
</html>
